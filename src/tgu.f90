!======================================================================!
program tgu
!----------------------------------------------------------------------!
use params
use vars
!----------------------------------------------------------------------!
implicit none
!----------------------------------------------------------------------!
integer :: i
!----------------------------------------------------------------------!
! To test grow_up subroutine.
!----------------------------------------------------------------------!
! Initialise individual.
!----------------------------------------------------------------------!
! Basal radius                                                       (m)
!----------------------------------------------------------------------!
rb  = 0.001
!----------------------------------------------------------------------!
ht  = hrat * rb
dp  = drat * ht
rt  = alpha_ag * rb
rdp = alpha_bg * rb
Ma  = rho_wood * (1.0 / 3.0) * pi * ht * (rb ** 2 + rb * rt  + rt ** 2)
Mb  = rho_wood * (1.0 / 3.0) * pi * dp * (rb ** 2 + rb * rdp + rdp ** 2)
rb_hw = zero
Ahw   = pi * rb_hw ** 2
Astem = pi * rb    ** 2
Asw   = Astem - Ahw
!----------------------------------------------------------------------!
! Relationship from Pretzsch et al. (2015).
!----------------------------------------------------------------------!
CPA = exp (a_p + alpha_p * log (200.0 * rb))
!----------------------------------------------------------------------!
Mfol = lasa * Asw / sla
An_base = zero
PLC = 0.0
Mfro = frasa * Asw / sfra
Mtot = Mfol + Ma + Mb + Mfro
rt_hw = alpha_ag * rb_hw
Ma_hw = rho_wood * (1.0 / 3.0) * pi * ht * &
        (rb_hw ** 2 + rb_hw * rt_hw + rt_hw ** 2)
Ma_sw = Ma - Ma_hw
rdp_hw = alpha_bg * rb_hw
Mb_hw = rho_wood * (1.0 / 3.0) * pi * dp * &
        (rb_hw ** 2 + rb_hw * rdp_hw + rdp_hw ** 2)
Mb_sw = Mb - Mb_hw
Mtot_nhw = Mfol + Ma_sw + Mb_sw + Mfro
Su = KSu * Mtot_nhw
St = KSt * Mtot_nhw
hbc = zero
fd = zero
write (*,*) 'LAI = ', sla * Mfol / CPA
!----------------------------------------------------------------------!
! Gross photosynthesis                        (mol[CO2] m[ground]-2 s-1)
!----------------------------------------------------------------------!
Ag_crown_mol = 10.0e-6
!----------------------------------------------------------------------!
! Net photosynthesis                          (mol[CO2] m[ground]-2 s-1)
!----------------------------------------------------------------------!
An_crown_mol = 10.0e-6 - 2.0e-6
!----------------------------------------------------------------------!
! Water and temperature growth modifiers                      (fraction)
!----------------------------------------------------------------------!
fW_gr = 1.0
fT_gr = 1.0
!----------------------------------------------------------------------!
! Sucrose concentration                                  (g[Su] d[DM]-1)
!----------------------------------------------------------------------!
Sc = Su / (Mtot_nhw + eps)
!----------------------------------------------------------------------!
! Sucrose growth modifer                                      (fraction)
!----------------------------------------------------------------------!
fa_Su = Sc ** n_Hill / (KSu ** n_Hill + Sc ** n_Hill)
!----------------------------------------------------------------------!
do kyr = 1, nyr
  do it = 1, ntimes
    CPA = exp (a_p + alpha_p * log (200.0 * rb))
    call grow_up
  end do ! it
  write (*,*) kyr, rb, ht, sla * Mfol / CPA
end do ! kyr
!----------------------------------------------------------------------!
end program tgu
!======================================================================!
